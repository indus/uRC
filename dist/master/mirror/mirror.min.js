var __extends=this.__extends||function(r,t){function e(){this.constructor=r}for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);e.prototype=t.prototype,r.prototype=new e},WAMP=require("../.typescript/wamp"),_=require("lodash"),when=require("when"),Mirror=function(r){function t(){var t=this;r.call(this),this.name="",this.map={},this.regs["mirror.reflection"]=function(){return t.reflection.apply(t,arguments)},this.regs.mirror=function(){return t.mirror.apply(t,arguments)}}return __extends(t,r),t.prototype.reflection=function(){var r=when.defer(),t=_.map(this.map,function(r,t,e){return this.session.call("mirror."+t).then(function(r){return r},function(){e[t]=!1,delete e[t]})},this);return when.all(t).then(function(t){r.resolve(_.reduce(_.compact(t),function(r,t){return r[t.module+"_"+t.id]=t,r},{}))}),r.promise},t.prototype.mirror=function(r){return r?(this.map[r[0]]=!0,console.log("[MIRROR] id:"+r[0]),r[0]):this.map},t.prototype.onopen=function(t,e){r.prototype.onopen.call(this,t,e)},t}(WAMP.Node);new Mirror;